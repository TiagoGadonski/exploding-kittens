@page "/gameboard"
@using Microsoft.AspNetCore.SignalR.Client
@inject NavigationManager Navigation

@code {
    private HubConnection _hubConnection;
    private List<string> _messages = new List<string>();
    private List<string> _cards = new List<string> { "Attack", "Skip", "Defuse", "Exploding Kitten" };
    private string _currentPlayer = "Player1";

    protected override async Task OnInitializedAsync()
    {
        _hubConnection = new HubConnectionBuilder()
            .WithUrl(Navigation.ToAbsoluteUri("/gamehub"))
            .Build();

        _hubConnection.On<string, string>("ReceiveMessage", (user, message) =>
        {
            var encodedMsg = $"{user}: {message}";
            _messages.Add(encodedMsg);
            InvokeAsync(StateHasChanged);
        });

        _hubConnection.On<string, string>("CardPlayed", (user, card) =>
        {
            var encodedMsg = $"{user} played {card}";
            _messages.Add(encodedMsg);
            InvokeAsync(StateHasChanged);
        });

        await _hubConnection.StartAsync();
    }

    private async Task PlayCard(string card)
    {
        await _hubConnection.SendAsync("PlayCard", _currentPlayer, card);
    }

    public async ValueTask DisposeAsync()
    {
        await _hubConnection.DisposeAsync();
    }
}

<div>
    <h3>Game Board</h3>
    <Hand Cards="_cards" OnPlayCard="PlayCard" />
    <ul>
        @foreach (var message in _messages)
        {
            <li>@message</li>
        }
    </ul>
</div>
